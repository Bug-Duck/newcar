{"version":3,"file":"index.mjs","sources":["../src/widgets/mathFunction.ts"],"sourcesContent":["import { WidgetOptions, WidgetStyle, Widget } from '@newcar/core'\nimport { Color } from '@newcar/utils'\nimport type { Canvas, CanvasKit, Paint, Path } from 'canvaskit-wasm'\nimport { Domain } from '../utils/domain'\nimport { Range } from '../utils/range'\n\nexport interface MathFunctionOptions extends WidgetOptions {\n  divisionY?: number\n  divisionX?: number\n  lineWidth?: number\n  style?: MathFunctionStyle\n  range?: Range\n}\n\nexport interface MathFunctionStyle extends WidgetStyle {\n  color?: Color\n  width?: number\n}\n\nexport class MathFunction extends Widget {\n  declare style: MathFunctionStyle\n  private path: Path\n  private paint: Paint\n  range: Range\n  lineWidth: number\n  divisionX: number\n  divisionY: number\n\n  constructor(\n    public fn: (x: number) => number,\n    public domain: Domain,\n    options?: MathFunctionOptions,\n  ) {\n    options ??= {}\n    super(options)\n    this.range = options.range ?? [-Infinity, Infinity]\n    this.divisionX = options.divisionX ?? 50\n    this.divisionY = options.divisionY ?? 50\n    options.style ??= {}\n    this.style.width = options.style.width ?? 2\n    this.style.color = options.style.color ?? Color.WHITE\n  }\n\n  init(ck: CanvasKit) {\n    this.paint = new ck.Paint()\n    this.paint.setColor(this.style.color!.toFloat4())\n    this.paint.setStyle(ck.PaintStyle.Stroke)\n    this.paint.setStrokeWidth((this.style.width! / this.divisionX) * 2)\n    this.path = new ck.Path()\n    this.path.moveTo(this.domain[0], this.fn(this.domain[0]))\n    for (\n      let x = this.domain[0];\n      x <= this.domain[0] + (this.domain[1] - this.domain[0]) * this.progress;\n      x += 1 / this.divisionX\n    ) {\n      const value = this.fn(x)\n      this.path.lineTo(x, value)\n    }\n  }\n\n  predraw(ck: CanvasKit, propertyChanged: string): void {\n    switch (propertyChanged) {\n      case 'fn':\n      case 'divisionX':\n      case 'divisionY':\n      case 'lineWidth':\n      case 'range':\n      case 'domain': {\n        console.log(this.domain)\n        this.path.reset()\n        this.path.moveTo(this.domain[0], this.fn(this.domain[0]))\n        for (\n          let x = this.domain[0];\n          x <=\n          this.domain[0] + (this.domain[1] - this.domain[0]) * this.progress;\n          x += 1 / this.divisionX\n        ) {\n          const value = this.fn(x)\n          this.path.lineTo(x, value)\n        }\n        break\n      }\n      case 'style.width': {\n        this.paint.setStrokeWidth((this.style.width! / this.divisionX) * 2)\n        break\n      }\n      case 'style.color': {\n        this.paint.setColor(this.style.color!.toFloat4())\n        break\n      }\n    }\n  }\n\n  draw(canvas: Canvas): void {\n    canvas.scale(this.divisionX, this.divisionY)\n    canvas.drawPath(this.path, this.paint)\n  }\n}\n"],"names":[],"mappings":"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"}